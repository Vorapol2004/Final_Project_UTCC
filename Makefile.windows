# Makefile for Windows (PowerShell compatible)
# Usage: Use with PowerShell or Git Bash

.PHONY: help up down build logs clean restart shell-spring shell-next shell-mysql install-frontend install-backend dev test

help:
	@echo "ğŸš€ Final Project UTCC - Makefile Commands (Windows)"
	@echo ""
	@echo "Docker Commands:"
	@echo "  make up              - Start all services (detached mode)"
	@echo "  make down            - Stop and remove all containers"
	@echo "  make build           - Build all Docker images"
	@echo "  make rebuild         - Rebuild all images (no cache)"
	@echo "  make logs            - Show logs from all services"
	@echo "  make logs-spring     - Show Spring Boot logs"
	@echo "  make logs-next       - Show Next.js logs"
	@echo "  make logs-mysql      - Show MySQL logs"
	@echo "  make restart         - Restart all services"
	@echo "  make clean           - Stop, remove containers and volumes"
	@echo "  make ps              - Show running containers"
	@echo ""
	@echo "Development Commands:"
	@echo "  make dev             - Show dev commands"
	@echo "  make install-frontend - Install Next.js dependencies"
	@echo ""
	@echo "Shell Access:"
	@echo "  make shell-spring    - Access Spring Boot container shell"
	@echo "  make shell-next      - Access Next.js container shell"
	@echo "  make shell-mysql     - Access MySQL container shell"
	@echo ""
	@echo "Utility Commands:"
	@echo "  make status          - Show status of all services"
	@echo "  make env-example    - Create .env from env.example"

up:
	@echo "ğŸš€ Starting all services..."
	docker-compose up -d
	@echo "âœ… Services started! Check with 'make logs' or 'make ps'"

down:
	@echo "ğŸ›‘ Stopping all services..."
	docker-compose down
	@echo "âœ… Services stopped"

build:
	@echo "ğŸ”¨ Building Docker images..."
	docker-compose build
	@echo "âœ… Build complete"

rebuild:
	@echo "ğŸ”¨ Rebuilding Docker images (no cache)..."
	docker-compose build --no-cache
	@echo "âœ… Rebuild complete"

up-build:
	@echo "ğŸ”¨ Building and starting services..."
	docker-compose up -d --build
	@echo "âœ… Services built and started!"

logs:
	@echo "ğŸ“‹ Showing logs (Ctrl+C to exit)..."
	docker-compose logs -f

logs-spring:
	@echo "ğŸ“‹ Showing Spring Boot logs..."
	docker-compose logs -f spring-boot

logs-next:
	@echo "ğŸ“‹ Showing Next.js logs..."
	docker-compose logs -f nextjs

logs-mysql:
	@echo "ğŸ“‹ Showing MySQL logs..."
	docker-compose logs -f mysql

restart:
	@echo "ğŸ”„ Restarting all services..."
	docker-compose restart
	@echo "âœ… Services restarted"

clean:
	@echo "ğŸ§¹ Cleaning up containers, volumes, and images..."
	docker-compose down -v
	@echo "âš ï¸  All containers and volumes removed!"

ps:
	@echo "ğŸ“Š Container status:"
	docker-compose ps

status: ps
	@echo ""
	@echo "ğŸŒ Service URLs:"
	@echo "  Frontend:  http://localhost:3000"
	@echo "  Backend:   http://localhost:8080"
	@echo "  MySQL:     localhost:3306"

shell-spring:
	@echo "ğŸš Accessing Spring Boot container..."
	docker-compose exec spring-boot sh

shell-next:
	@echo "ğŸš Accessing Next.js container..."
	docker-compose exec nextjs sh

shell-mysql:
	@echo "ğŸš Accessing MySQL container..."
	docker-compose exec mysql bash

dev:
	@echo "ğŸ’» Development mode - Make sure MySQL is running!"
	@echo "Run these commands in separate terminals:"
	@echo "  1. Backend:  cd asset_it_support_spring_boot && mvnw.cmd spring-boot:run"
	@echo "  2. Frontend: cd asset_it_support_nextjs && npm run dev"

install-frontend:
	@echo "ğŸ“¦ Installing Next.js dependencies..."
	cd asset_it_support_nextjs && npm install
	@echo "âœ… Frontend dependencies installed"

env-example:
	@if not exist .env ( \
		echo "ğŸ“ Creating .env from env.example..." && \
		copy env.example .env && \
		echo "âœ… .env created! Please edit it with your settings." \
	) else ( \
		echo "âš ï¸  .env already exists. Delete it first if you want to recreate." \
	)

setup: env-example
	@echo "ğŸš€ First time setup..."
	@echo "ğŸ“ Please edit .env file with your settings"
	@echo "Then run: make up-build"

